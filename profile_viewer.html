<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Profile viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="nav-placeholder"></div>
<script src="nav_script.js"></script>
<h1>Profile viewer</h1>

<div class="container">
Kijk hier naar CV profielen<br><br>

<!-- (AS) Dropdown voor CV IDs -->
<div style="display: flex; align-items: center; gap: 20px;">
    <label for="available_cvs" style="white-space: nowrap;">Selecteer een CV:</label>
    <select name="available_cvs" id="available_cvs" onchange="createDropDownProfiles()">
        <option value="" disabled selected>CV</option>
    </select>
</div>

<div style="display: flex; align-items: center; gap: 20px;">
    <label for="profiles" style="white-space: nowrap;">Selecteer een profiel:</label>
    <select name="profiles" id="profiles">
        <option value="" disabled selected>Profiel</option>
    </select>
</div>

<br>


<button id="BtnViewProfile" style="line-height: 10px">Geef profiel weer</button>

<div class="container">

<h3>Response</h3>
<pre id="responseBox">Nog geen response</pre>

</div>
<br>
<button id="BtnDelen" style="line-height: 10px">Delen</button>
<br>
<div class="container">

<h3>Response</h3>
<pre id="responseBox2">Nog geen response</pre>

</div>


<script>
    
// Basis URL voor API
const API_BASE_URL = "https://ack2511-reisbureau-fdghe5emesfrbza5.swedencentral-01.azurewebsites.net";
// const API_BASE_URL = "http://127.0.0.1:5001";
const dropdownCVs = document.getElementById("available_cvs");
const BtnViewProfile = document.getElementById("BtnViewProfile");
const responseBox = document.getElementById("responseBox")
const responseBox2 = document.getElementById("responseBox2")
const BtnDelen = document.getElementById("BtnDelen")


// Function die CV IDs dropdown laadt
async function loadAvailableCvs() {
    dropdownCVs.innerHTML = '<option value="" disabled selected>CV</option>';

    fetch(`${API_BASE_URL}/profile_viewer/get_cvs`)
        .then((response) => response.json())
        .then((cvs) => {
        cvs.forEach((cv) => {
            const hasProfile = !!cv.HasProfile; // normaliseer naar boolean
            const option = document.createElement("option");

            // Toon groen vinkje of rood kruis aan het einde
            const icon = hasProfile ? " ✅" : " ❌";

            option.value = cv.ID;
            option.textContent = `${cv.ID} - ${cv.FileName}${icon}`;

            // Extra: voeg ARIA/tooltip toe voor toegankelijkheid
            option.title = hasProfile ? "Heeft profiel" : "Geen profiel";

            // Extra: flag op het element voor eventueel later filteren/sorteren
            option.dataset.hasProfile = hasProfile ? "true" : "false";

            dropdownCVs.appendChild(option);
        });
        })
        .catch((error) => console.error("Error fetching CVs:", error));
    }

// (AS) initieel laden bij page load
loadAvailableCvs();

// Maak profiles dropdown dynamisch op basis van CV
function createDropDownProfiles() {
    const selectedValue = document.getElementById("available_cvs").value;
    const dropdown = document.getElementById("profiles");
    dropdown.innerHTML = '<option value="" disabled selected>Selecteer profiel</option>'; // reset

    fetch(`${API_BASE_URL}/profile_viewer/get_profiles`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ CV_ID: selectedValue })
    })
    .then(response => response.json())
    .then(profiles => {
        profiles.forEach(profile => {
            const option = document.createElement("option");
            option.value = profile.ID;
            option.textContent = `${profile.ID} - ${profile.naam}`;
            dropdown.appendChild(option);
        });
    })
    .catch(error => console.error("Error fetching profiles:", error));
}

async function viewProfile() {
    const selectedValue = document.getElementById("profiles").value;
    try {
        const response = await fetch(`${API_BASE_URL}/profile_viewer/view_profile`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ profile_id: selectedValue })
        });

        const data = await response.json();
        responseBox.textContent = `Het profiel: ${JSON.stringify(data, null, 2)}`;

    } catch (err) {
        responseBox.textContent = "Fout: " + err;
    }
}

BtnViewProfile.addEventListener("click", viewProfile);

async function shareProfile() {
    const selectedValue = document.getElementById("profiles").value;
    try {
    const response = await fetch(`${API_BASE_URL}/profile_viewer/share_profile`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ profile_id: selectedValue })
    });

    const data = await response.json();

    const fullUrl = `${API_BASE_URL}${data.share_url}`;
    responseBox2.innerHTML = `Hier is de URL:<br><a href="${fullUrl}" target="_blank">${fullUrl}</a>`;
    }
    catch (err) {
        responseBox2.textContent = "Fout: " + err;
    }

}

BtnDelen.addEventListener("click", shareProfile);

</script>

</body>
</html>
