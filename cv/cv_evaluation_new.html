<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <title>CV Tool – CVs evalueren met vacature</title>

  <!-- Jullie bestaande styling -->
  <link rel="stylesheet" href="/assets/css/cv.css" />

  <style>
    /* ====== Consistente basis (zelfde look & feel als je andere pagina’s) ====== */
    body.cv { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .layout { display:flex; min-height:100vh; }
    .sidebar {
      width:220px; background:#111827; color:#e5e7eb; padding:24px 16px; box-sizing:border-box;
      display:flex; flex-direction:column; align-items:stretch; gap:16px;
    }
    .sidebar-logo { width:40px; height:40px; border-radius:12px; margin-bottom:4px; align-self:center; }
    .sidebar-logo img { width:100%; height:100%; object-fit:contain; display:block; }
    .sidebar-title { font-size:20px; font-weight:600; text-align:center; margin-bottom:16px; }
    .nav-btn {
      display:block; width:100%; margin-bottom:6px; padding:8px 12px; border-radius:999px;
      border:1px solid transparent; background:#1f2937; color:#e5e7eb; text-align:left; cursor:pointer; font-size:14px;
    }
    .nav-btn.active { background:#0f62fe; border-color:#60a5fa; }
    .nav-btn:not(.active):hover { background:#111827; }

    .main { flex:1; padding:24px 32px; box-sizing:border-box; }
    .main-header h1 { margin:0 0 4px 0; font-size:28px; }
    .card {
      background:#fff; border-radius:16px; padding:16px 18px; box-shadow:0 10px 22px rgba(2,6,23,.08);
      box-sizing:border-box;
    }
    .stack { display:flex; flex-direction:column; gap:12px; }
    .muted { color:#6b7280; font-size:13px; }
    .hidden { display:none !important; }

    label { font-size:14px; color:#0f172a; }
    select, textarea, input[type="text"], input[type="file"] {
      width:100%; box-sizing:border-box; padding:8px 10px; border-radius:8px;
      border:1px solid rgba(15,23,42,.14); font-size:14px; font-family:inherit;
    }
    textarea { resize:vertical; min-height:70px; }

    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:6px;
      border-radius:999px; border:1px solid transparent; padding:6px 14px;
      font-size:14px; cursor:pointer; font-family:inherit;
    }
    .btn-primary { background:#0f62fe; color:#fff; box-shadow:0 12px 24px rgba(15,98,254,.20); }
    .btn-secondary { background:#e5e7eb; color:#111827; }
    .btn-ghost { background:transparent; color:#111827; border-color:rgba(15,23,42,.14); }

    .btn-row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }

    .alert { border-radius:8px; padding:6px 10px; font-size:13px; margin-top:8px; }
    .alert-info { background:#eff6ff; color:#1d4ed8; }
    .alert-success { background:#ecfdf5; color:#15803d; }
    .alert-warning { background:#fffbeb; color:#92400e; }
    .alert-danger { background:#fef2f2; color:#b91c1c; }

    .label-inline { font-size:13px; color:#64748b; margin-bottom:4px; display:block; }

    /* ====== Wireframe layout: boven filters, onder results 2-koloms ====== */
    .filters-row {
      display:grid;
      grid-template-columns: minmax(220px, 260px) minmax(220px, 260px) 1fr;
      gap:16px;
      align-items:end;
    }
    .filters-row .field { min-width: 0; }
    .filters-row .actions { display:flex; justify-content:flex-end; gap:8px; flex-wrap:wrap; }

    .results-grid {
      display:grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap:18px;
      align-items:start;
    }

    /* ====== Score bar ====== */
    .score-row { display:flex; align-items:center; gap:12px; }
    .score-label { font-weight:600; }
    .score-bar {
      flex:1;
      height:14px;
      border-radius:999px;
      background: rgba(15,23,42,.10);
      overflow:hidden;
      border:1px solid rgba(15,23,42,.12);
    }
    .score-bar-fill {
      height:100%;
      width:0%;
      background:#111827; /* neutraal; je kunt eventueel per score class kleuren als je wilt */
      transition: width .25s ease;
    }
    .score-value { min-width:70px; text-align:right; font-variant-numeric: tabular-nums; }

    /* ====== Sterktes / Aandachtspunten boxes ====== */
    .box {
      border-radius:12px;
      border:1px solid rgba(15,23,42,.14);
      padding:12px 12px;
    }
    .box h3 { margin:0 0 8px 0; font-size:14px; }
    .box ul { margin:0; padding-left:18px; font-size:13px; }
    .box li { margin: 2px 0; }

    .box-green { background: #e9f7e9; border-color: rgba(22,163,74,.25); }
    .box-orange { background: #fff3df; border-color: rgba(249,115,22,.30); }

    /* ====== Rechterkolom ====== */
    .right-block h3 { margin:0 0 8px 0; font-size:14px; }
    .right-block p, .right-block ul { margin:0; font-size:13px; }
    .right-block ul { padding-left:18px; }

    /* Laat "ai-eval-card" bestaan voor JS, maar we tonen onze eigen weergave */
    #ai-eval-card { display:none !important; }
    #evalResponse { display:none !important; } /* technische JSON niet tonen op deze pagina */
  </style>
</head>

<body class="cv">
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <img src="/assets/img/logo.png" alt="Bedrijfslogo">
      </div>
      <div class="sidebar-title">CV Tool</div>

<nav>
  <a class="nav-btn" href="/cv/index.html">Dashboard</a>
  <a class="nav-btn" href="/cv/cv_reader_new.html">Upload &amp; Bekijk CV</a>
  <a class="nav-btn active" href="/cv/cv_evaluation_new.html">Evalueer CVs</a>
    <a class="nav-btn" href="/cv/profile_viewer_new.html">Profielen</a>
  <a class="nav-btn" href="/cv/vacatures.html">Vacatures</a>

</nav>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="main-header">
        <h1>CV Tool - CVs evalueren met vacature</h1>
        <p class="muted">Selecteer een CV en vacature en laat AI een fit-score en feedback genereren <br><u>Hulpmiddel</u>, geen automatische beslissing.</p>
      </header>

      <section class="card stack">
        <!-- Filters -->
        <div class="filters-row" aria-label="Selecties">
          <div class="field">
            <label for="eval_cv_id" class="label-inline">Selecteer CV</label>
            <select id="eval_cv_id"></select>
          </div>

          <div class="field">
            <label for="eval_vacancy_id" class="label-inline">Selecteer Vacature</label>
            <select id="eval_vacancy_id"></select>
          </div>

          <div class="actions">
            <button id="evaluateBtn" type="button" class="btn btn-primary">Evalueer CV</button>
            <button id="evaluateClearBtn" type="button" class="btn btn-ghost">Wissen</button>
          </div>
        </div>

        <div class="field">
          <label for="eval_notes" class="label-inline">Extra context (optioneel)</label>
          <textarea id="eval_notes" placeholder="Bijv. focus op junior profiel, data engineering, leiderschap, …"></textarea>
        </div>

        <div id="evalStatus" class="alert hidden"></div>

        <!-- Resultaat -->
        <div class="results-grid" aria-label="Evaluatie resultaat">
          <!-- Links -->
          <div class="stack">
            <div class="stack" style="gap:10px;">
              <div class="score-row">
                <div class="score-label">Score:</div>
                <div class="score-bar" aria-label="score balk">
                  <div id="scoreBarFill" class="score-bar-fill"></div>
                </div>
                <div id="scoreValue" class="score-value muted">0/100</div>
              </div>
            </div>

            <div class="box box-green">
              <h3>Sterke punten:</h3>
              <ul id="strengthsList">
                <li class="muted">Nog geen evaluatie.</li>
              </ul>
            </div>

            <div class="box box-orange">
              <h3>Aandachtspunten:</h3>
              <ul id="gapsList">
                <li class="muted">Nog geen evaluatie.</li>
              </ul>
            </div>
          </div>

          <!-- Rechts -->
          <div class="stack right-block">
            <div>
              <h3>Samenvatting:</h3>
              <p id="summaryText" class="muted">Nog geen evaluatie.</p>
            </div>

            <div>
              <h3>Aanbevolen vervolgstappen:</h3>
              <ul id="stepsList">
                <li class="muted">Nog geen evaluatie.</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Nodig voor cv-vacature-analyse.js (wordt door JS gevuld, maar wij verbergen het via CSS) -->
        <div id="ai-eval-card" class="card hidden"></div>
        <pre id="evalResponse" class="hidden"></pre>
      </section>

      <!-- ========================= -->
      <!-- Hidden stubs (voorkomt null-errors in cv-vacature-analyse.js) -->
      <!-- ========================= -->
      <section style="display:none;">
        <!-- Upload CV -->
        <input type="file" id="cvFile" />
        <button id="uploadBtn" type="button"></button>
        <button id="uploadCvClear" type="button"></button>
        <div id="uploadCvStatus"></div>
        <pre id="uploadResponse"></pre>

        <!-- Upload Vacature -->
        <input type="text" id="vacTitle" />
        <input type="file" id="vacFile" />
        <textarea id="vacText"></textarea>
        <button id="uploadVacBtn" type="button"></button>
        <button id="uploadVacTextBtn" type="button"></button>
        <button id="uploadVacClear" type="button"></button>
        <div id="uploadVacStatus"></div>
        <pre id="vacUploadResponse"></pre>

        <!-- Vacancy evaluation -->
        <select id="vac_eval_id"></select>
        <textarea id="vac_eval_notes"></textarea>
        <button id="vac_eval_btn" type="button"></button>
        <div id="vacEvalStatus"></div>
        <pre id="vac_eval_response"></pre>

        <!-- Matching -->
        <select id="match_vacancy_id"></select>
        <button id="match_vacancy_btn" type="button"></button>
        <pre id="match_vacancy_results"></pre>

        <select id="match_cv_id"></select>
        <button id="match_cv_btn" type="button"></button>
        <pre id="match_cv_results"></pre>

        <!-- Viewer / notes -->
        <select id="viewer_type"></select>
        <select id="viewer_id"></select>
        <pre id="viewer_details"></pre>
        <div id="viewer_details_pretty"></div>
        <textarea id="viewer_notes"></textarea>
        <button id="viewer_save_notes" type="button"></button>
        <pre id="viewer_save_response"></pre>
        <div id="viewerStatus"></div>
      </section>
    </main>
  </div>

  <!-- Laad alleen deze JS om identifier-conflicten te vermijden -->
  <script src="/assets/js/cv-vacature-analyse.js" defer></script>

  <!-- UI-mapper: leest de JSON output van /cv/evaluate en zet het in wireframe layout -->
  <script>
    (function () {
      const evalPre = document.getElementById("evalResponse");
      const scoreFill = document.getElementById("scoreBarFill");
      const scoreValue = document.getElementById("scoreValue");
      const strengthsList = document.getElementById("strengthsList");
      const gapsList = document.getElementById("gapsList");
      const summaryText = document.getElementById("summaryText");
      const stepsList = document.getElementById("stepsList");

      if (!evalPre || !scoreFill || !scoreValue || !strengthsList || !gapsList || !summaryText || !stepsList) return;

      function setList(ul, items, emptyText) {
        ul.innerHTML = "";
        if (!Array.isArray(items) || items.length === 0) {
          const li = document.createElement("li");
          li.className = "muted";
          li.textContent = emptyText;
          ul.appendChild(li);
          return;
        }
        items.forEach(x => {
          const li = document.createElement("li");
          li.textContent = String(x);
          ul.appendChild(li);
        });
      }

      function applyResult(payload) {
        const r = payload?.result || payload?.Result || payload?.data?.result || null;
        if (!r) return;

        const score = Number(r.fit_score ?? 0);
        scoreFill.style.width = Math.max(0, Math.min(100, score)) + "%";
        scoreValue.textContent = `${score}/100`;

        summaryText.textContent = r.fit_summary ? String(r.fit_summary) : "—";

        setList(strengthsList, r.strengths, "Geen sterke punten gedetecteerd.");
        setList(gapsList, r.gaps, "Geen aandachtspunten genoemd.");
        setList(stepsList, r.recommended_next_steps, "Geen vervolgstappen voorgesteld.");
      }

      // Observeer wijzigingen (cv-vacature-analyse.js schrijft JSON in evalResponse)
      const obs = new MutationObserver(() => {
        try {
          const txt = (evalPre.textContent || "").trim();
          if (!txt) return;
          const data = JSON.parse(txt);
          applyResult(data);
        } catch {
          /* ignore parse issues */
        }
      });

      obs.observe(evalPre, { childList: true, subtree: true, characterData: true });
    })();
  </script>
</body>
</html>
